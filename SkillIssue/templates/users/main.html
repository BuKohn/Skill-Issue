{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Skill Issue</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <header class="header" id="header">
        <nav class="header-container">
            <a class="logo" href="{% url 'main_page' %}">Skill Issue</a>
            <div class="nav-group nav-group-left">
                <a class="nav-links" href="{% url 'guides_list' %}">руководства</a>
                <a class="nav-links" href="{% url 'announcements_list' %}">объявления</a>
            </div>
            <div class="nav-group nav-group-right">
                <div class="search-container">
                    <input class="search" placeholder="поиск руководств, анкет и профилей" id="searchInput">
                    <div class="search-dropdown" id="searchDropdown">
                    </div>
                </div>
                <a class="nav-links">избранное</a>
                <div class="menu-container" id="menu-container">
                    <a class="nav-links" href="{% url 'login_page' %}">войти</a>
                    <div class="context-menu">
                        <a href="{% url 'register_page' %}">зарегистрироваться</a>
                        <a href="{% url 'login_page' %}">войти</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="body-background">
        <img src="{% static 'images/logo.png' %}" alt="Skill Issue logo"
             style="width: 40%; height: auto; margin-top: 50px;">
        <br><br>
        <hr style="width: 50%; color: ghostwhite">
        <p class="logo" style="color: black; font-size: 2.5rem">Skill Issue</p>
        <hr style="width: 40%; color: ghostwhite">
        <p class="simple-text" style="margin-top: 5px">проект для поиска и обмена навыками</p>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <table class="simple-text" style="width: 100%; height: 100%; color: lightgray; font-size: 1rem">
                <tr>
                    <td colspan="3" style="width:33%;">
                        <a href="https://www.sfu.ru/ru" class="nav-group-left"
                           style="text-decoration: none; color: lightgray; margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;">
                           Сибирский Федеральный Университет
                        </a>
                    </td>
                    <td style="text-align:right;">
                        <p class="nav-group-right" style="margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;">@skill_issue 2025</p>
                    </td>
                </tr>
                <tr>
                    <td><p style="text-align:left">@bukohm</p></td>
                    <td><p style="text-align:center">@hoolkayyy</p></td>
                    <td><p style="text-align:right">@K1rkaSs</p></td>
                </tr>
            </table>
        </div>
    </footer>

<script src="{% static 'js/auth.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const menuContainer = document.querySelector(".menu-container");

    try {
        // Используем authManager для запроса с JWT токеном
        const response = await authManager.apiRequest("/api/me/");

        if (response.ok) {
            const user = await response.json();
            menuContainer.innerHTML = `
                <a class="nav-links" href="/users/${user.username}/" style="margin-right: 20px;">профиль</a>
                <a class="nav-links" href="#" id="logout-btn">выйти</a>
            `;

            const logoutBtn = document.getElementById("logout-btn");
            if (logoutBtn) {
                logoutBtn.addEventListener("click", async (e) => {
                    e.preventDefault();
                    authManager.logout();
                });
            }
        } else {
            // Если не авторизован, показываем стандартное меню
            menuContainer.innerHTML = `
                <a class="nav-links" href="{% url 'login_page' %}">войти</a>
                <div class="context-menu">
                    <a href="{% url 'register_page' %}">зарегистрироваться</a>
                    <a href="{% url 'login_page' %}">войти</a>
                </div>
            `;
        }
    } catch (err) {
        console.error("Ошибка при проверке авторизации", err);
        // При ошибке показываем стандартное меню
        menuContainer.innerHTML = `
            <a class="nav-links" href="{% url 'login_page' %}">войти</a>
            <div class="context-menu">
                <a href="{% url 'register_page' %}">зарегистрироваться</a>
                <a href="{% url 'login_page' %}">войти</a>
            </div>
        `;
    }
});
</script>
<script src="{% static 'js/search.js' %}"></script>
</body>
</html>
