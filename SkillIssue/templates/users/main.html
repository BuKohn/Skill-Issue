{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Skill Issue</title>
    <!--<link rel="stylesheet" href="{% static 'css/styles.css' %}">-->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header" id="header">
        <nav class="header-container">
            <a class="logo" href="{% url 'main_page' %}">Skill Issue</a>
            <div class="nav-group nav-group-left">
                <a class="nav-links" href="{% url 'guides_list' %}" data-lang-ru="—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞" data-lang-en="guides">—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞</a>
                <a class="nav-links" href="{% url 'announcements_list' %}" data-lang-ru="–æ–±—ä—è–≤–ª–µ–Ω–∏—è" data-lang-en="announcements">–æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
            </div>
            <div class="nav-group nav-group-right">
                <div class="search-container">
                    <input class="search" placeholder="–ø–æ–∏—Å–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤, –∞–Ω–∫–µ—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π" id="searchInput"
                           data-placeholder-ru="–ø–æ–∏—Å–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤, –∞–Ω–∫–µ—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π"
                           data-placeholder-en="search guides, profiles and announcements">
                    <div class="search-dropdown" id="searchDropdown">
                    </div>
                </div>
                <a class="nav-links" data-lang-ru="–∏–∑–±—Ä–∞–Ω–Ω–æ–µ" data-lang-en="favorites">–∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                <a class="nav-links" id="language-toggle" href="#" onclick="toggleLanguage(event)" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫">RU</a>
                <div class="menu-container" id="menu-container">
                    <a class="nav-links" href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                    <div class="context-menu">
                        <a href="{% url 'register_page' %}" data-lang-ru="–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" data-lang-en="register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                        <a href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="body-background">
        <img src="{% static 'images/logo.png' %}" alt="Skill Issue logo"
             style="width: 40%; height: auto; margin-top: 50px;">
        <br><br>
        <hr style="width: 50%; color: ghostwhite">
        <p class="logo" style="color: black; font-size: 2.5rem">Skill Issue</p>
        <hr style="width: 40%; color: ghostwhite">
        <p class="simple-text" style="margin-top: 5px" data-lang-ru="–ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ–±–º–µ–Ω–∞ –Ω–∞–≤—ã–∫–∞–º–∏" data-lang-en="project for finding and sharing skills">–ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ–±–º–µ–Ω–∞ –Ω–∞–≤—ã–∫–∞–º–∏</p>
        <div class="carousel-container">
            <div class="carousel" id="carousel">
                <div class="carousel-slide">
                    <img src="{% static 'images/slide1.jpg' %}">
                    <div class="slide-caption">
                        <div class="slide-title" data-lang-ru="–û—Å–Ω–æ–≤—ã Python" data-lang-en="Python Basics">–û—Å–Ω–æ–≤—ã Python</div>
                        <div class="slide-author" data-lang-ru="–ê–≤—Ç–æ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" data-lang-en="Author: Ivan Petrov">–ê–≤—Ç–æ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</div>
                    </div>
                </div>
                <div class="carousel-slide">
                    <img src="{% static 'images/slide2.jpg' %}">
                    <div class="slide-caption">
                        <div class="slide-title" data-lang-ru="–í–µ–±-–¥–∏–∑–∞–π–Ω" data-lang-en="Web Design">–í–µ–±-–¥–∏–∑–∞–π–Ω</div>
                        <div class="slide-author" data-lang-ru="–ê–≤—Ç–æ—Ä: –ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞" data-lang-en="Author: Maria Sidorova">–ê–≤—Ç–æ—Ä: –ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞</div>
                    </div>
                </div>
                <div class="carousel-slide">
                    <img src="{% static 'images/slide3.jpg' %}">
                    <div class="slide-caption">
                        <div class="slide-title" data-lang-ru="Git –∏ GitHub" data-lang-en="Git & GitHub">Git –∏ GitHub</div>
                        <div class="slide-author" data-lang-ru="–ê–≤—Ç–æ—Ä: –ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤" data-lang-en="Author: Alexey Kozlov">–ê–≤—Ç–æ—Ä: –ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤</div>
                    </div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <button class="carousel-btn prev" onclick="moveSlide(-1)" aria-label="Previous slide">&lt;</button>
            <button class="carousel-btn next" onclick="moveSlide(1)" aria-label="Next slide">&gt;</button>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </div>
    </div>

    <!-- –ß–∞—Ç -->
    <button type="button" id="floating-button" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">
        üí¨
    </button>

    <div id="chat-modal" >
        <div id="chat-contacts">
            <div id="chat-header">
                <span>–ß–∞—Ç—ã</span>
                <button id="chat-close-button">&times;</button>
            </div>
            <!--–°–ü–ò–°–û–ö –ö–û–ù–¢–ê–ö–¢–û–í-->
            <div id="chat-list">
                <a href="#" class="chat-item" data-user-id="1">
                    <img src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                    <div style="flex: 1;">
                        <div class="username">–ê–ª–µ–∫—Å–µ–π</div>
                    </div>
                </a>
                <a href="#" class="chat-item" data-user-id="2">
                    <img src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                    <div style="flex: 1;">
                        <div class="username">–ú–∞—Ä–∏—è</div>
                    </div>
                </a>
            </div>
        </div>

        <div id="chat-dialog" style="display: none;">
            <div id="dialog-header">
                <button id="back-to-chats">&lt;</button>
                <img id="dialog-avatar" src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                <a id="profile-link" href="#">–ù–∏–∫–Ω–µ–π–º</a>
            </div>

            <div id="messages-container" style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background-color: #f9f9f9;"></div>

            <div style="padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #eee;">
                <form id="message-form" style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="message-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                           style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 0.95rem;" autocomplete="off">
                    <button type="submit" style="
                        background: linear-gradient(135deg, #00BFFF 0%, #0099CC 100%);
                        color: white;
                        border: none;
                        border-radius: 20px;
                        padding: 10px 24px;
                        font-size: 0.95rem;
                        font-weight: 600;
                        cursor: pointer;
                        box-shadow: 0 2px 8px rgba(0, 191, 255, 0.3);
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        min-width: 100px;
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(0, 191, 255, 0.4)';" 
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 191, 255, 0.3)';">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- –ö–æ–Ω–µ—Ü —á–∞—Ç–∞ -->

    <footer class="footer">
        <div class="footer-container">
            <table class="simple-text" style="width: 100%; height: 100%; color: lightgray; font-size: 1rem">
                <tr>
                    <td colspan="3" style="width:33%;">
                        <a href="https://www.sfu.ru/ru" class="nav-group-left"
                           style="text-decoration: none; color: lightgray; margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;"
                           data-lang-ru="–°–∏–±–∏—Ä—Å–∫–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç" data-lang-en="Siberian Federal University">
                           –°–∏–±–∏—Ä—Å–∫–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç
                        </a>
                    </td>
                    <td style="text-align:right;">
                        <p class="nav-group-right" style="margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;">@skill_issue 2025</p>
                    </td>
                </tr>
                <tr>
                    <td><p style="text-align:left">@bukohm</p></td>
                    <td><p style="text-align:center">@hoolkayyy</p></td>
                    <td><p style="text-align:right">@K1rkaSs</p></td>
                </tr>
            </table>
        </div>
    </footer>

<script src="{% static 'js/auth.js' %}"></script>
<script src="{% static 'js/toggle_chat.js' %}"></script>
<script src="{% static 'js/toggle_language.js' %}"></script>
<script src="{% static 'js/filter.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const menuContainer = document.querySelector(".menu-container");

    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º authManager –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º
        const response = await authManager.apiRequest("/api/me/");

        if (response.ok) {
            const user = await response.json();
            menuContainer.innerHTML = `
                <a class="nav-links" href="/users/${user.username}/" style="margin-right: 20px;" data-lang-ru="–ø—Ä–æ—Ñ–∏–ª—å" data-lang-en="profile">–ø—Ä–æ—Ñ–∏–ª—å</a>
                <a class="nav-links" href="#" id="logout-btn" data-lang-ru="–≤—ã–π—Ç–∏" data-lang-en="log out">–≤—ã–π—Ç–∏</a>
            `;
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —è–∑—ã–∫ –∫ –Ω–æ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
            setTimeout(() => {
                if (typeof applyLanguage === 'function') {
                    applyLanguage(currentLang);
                }
            }, 100);

            const logoutBtn = document.getElementById("logout-btn");
            if (logoutBtn) {
                logoutBtn.addEventListener("click", async (e) => {
                    e.preventDefault();
                    authManager.logout();
                });
            }
        } else {
            // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ–Ω—é
            menuContainer.innerHTML = `
                <a class="nav-links" href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                <div class="context-menu">
                    <a href="{% url 'register_page' %}" data-lang-ru="–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" data-lang-en="register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    <a href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
                </div>
            `;
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —è–∑—ã–∫ –∫ –Ω–æ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
            setTimeout(() => {
                if (typeof applyLanguage === 'function') {
                    applyLanguage(currentLang);
                }
            }, 100);
        }
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏", err);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ–Ω—é
        menuContainer.innerHTML = `
            <a class="nav-links" href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
            <div class="context-menu">
                <a href="{% url 'register_page' %}" data-lang-ru="–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" data-lang-en="register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                <a href="{% url 'login_page' %}" data-lang-ru="–≤–æ–π—Ç–∏" data-lang-en="log in">–≤–æ–π—Ç–∏</a>
            </div>
        `;
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —è–∑—ã–∫ –∫ –Ω–æ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
        setTimeout(() => {
            if (typeof applyLanguage === 'function') {
                applyLanguage(currentLang);
            }
        }, 100);
    }
});
</script>
<script>
function toggleLanguage(event) {
    event.preventDefault();
    const langBtn = document.getElementById('language-toggle');
    
    if (langBtn.textContent.trim() === 'RU') {
        langBtn.textContent = 'EN';
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
        alert('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (–∑–∞–≥–ª—É—à–∫–∞)');
    } else {
        langBtn.textContent = 'RU';
        alert('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–∑–∞–≥–ª—É—à–∫–∞)');
    }
}
</script>
<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.carousel-slide');
    const totalSlides = slides.length;
    const carousel = document.getElementById('carousel');
    const indicatorsContainer = document.getElementById('carouselIndicators');

    for (let i = 0; i < totalSlides; i++) {
        const indicator = document.createElement('div');
        indicator.classList.add('indicator');
        if (i === 0) indicator.classList.add('active');
        indicator.addEventListener('click', () => goToSlide(i));
        indicatorsContainer.appendChild(indicator);
    }

     function updateCarousel() {
        carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
        const indicators = document.querySelectorAll('.indicator');
        indicators.forEach((ind, idx) => {
        ind.classList.toggle('active', idx === currentSlide);
        });
    }

     function goToSlide(index) {
        if (index < 0) index = totalSlides - 1;
        if (index >= totalSlides) index = 0;
        currentSlide = index;
        updateCarousel();
    }

        function moveSlide(direction) {
            goToSlide(currentSlide + direction);
    }

    setInterval(() => moveSlide(1), 5000);
</script>
</body>
</html>
