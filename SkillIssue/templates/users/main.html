{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Skill Issue</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <header class="header" id="header">
        <nav class="header-container">
            <a class="logo" href="{% url 'main_page' %}">Skill Issue</a>
            <div class="nav-group nav-group-left">
                <a class="nav-links" href="{% url 'guides_list' %}">—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞</a>
                <a class="nav-links" href="{% url 'announcements_list' %}">–æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
            </div>
            <div class="nav-group nav-group-right">
                <div class="search-container">
                    <input class="search" placeholder="–ø–æ–∏—Å–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤, –∞–Ω–∫–µ—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π" id="searchInput">
                    <div class="search-dropdown" id="searchDropdown">
                    </div>
                </div>
                <a class="nav-links">–∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                <div class="menu-container" id="menu-container">
                    <a class="nav-links" href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
                    <div class="context-menu">
                        <a href="{% url 'register_page' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                        <a href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="body-background">
        <img src="{% static 'images/logo.png' %}" alt="Skill Issue logo"
             style="width: 40%; height: auto; margin-top: 50px;">
        <br><br>
        <hr style="width: 50%; color: ghostwhite">
        <p class="logo" style="color: black; font-size: 2.5rem">Skill Issue</p>
        <hr style="width: 40%; color: ghostwhite">
        <p class="simple-text" style="margin-top: 5px">–ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ–±–º–µ–Ω–∞ –Ω–∞–≤—ã–∫–∞–º–∏</p>
    </div>

    <!-- –ß–∞—Ç -->
    <button type="button" id="floating-button" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">
        üí¨
    </button>

    <div id="chat-modal" >
        <div id="chat-contacts">
            <div id="chat-header">
                <span>–ß–∞—Ç—ã</span>
                <button id="chat-close-button">&times;</button>
            </div>
            <!--–°–ü–ò–°–û–ö –ö–û–ù–¢–ê–ö–¢–û–í-->
            <div id="chat-list">
                <a href="#" class="chat-item" data-user-id="1">
                    <img src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                    <div style="flex: 1;">
                        <div class="username">–ê–ª–µ–∫—Å–µ–π</div>
                    </div>
                </a>
                <a href="#" class="chat-item" data-user-id="2">
                    <img src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                    <div style="flex: 1;">
                        <div class="username">–ú–∞—Ä–∏—è</div>
                    </div>
                </a>
            </div>
        </div>

        <div id="chat-dialog" style="display: none;">
            <div id="dialog-header">
                <button id="back-to-chats">&lt;</button>
                <img id="dialog-avatar" src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                <a id="profile-link" href="#">–ù–∏–∫–Ω–µ–π–º</a>
            </div>

            <div id="messages-container" style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background-color: #f9f9f9;"></div>

            <div style="padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #eee;">
                <form id="message-form" style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="message-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                           style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 0.95rem;" autocomplete="off">
                    <button type="submit" style="
                        background: linear-gradient(135deg, #00BFFF 0%, #0099CC 100%);
                        color: white;
                        border: none;
                        border-radius: 20px;
                        padding: 10px 24px;
                        font-size: 0.95rem;
                        font-weight: 600;
                        cursor: pointer;
                        box-shadow: 0 2px 8px rgba(0, 191, 255, 0.3);
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        min-width: 100px;
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(0, 191, 255, 0.4)';" 
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0, 191, 255, 0.3)';">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- –ö–æ–Ω–µ—Ü —á–∞—Ç–∞ -->

    <footer class="footer">
        <div class="footer-container">
            <table class="simple-text" style="width: 100%; height: 100%; color: lightgray; font-size: 1rem">
                <tr>
                    <td colspan="3" style="width:33%;">
                        <a href="https://www.sfu.ru/ru" class="nav-group-left"
                           style="text-decoration: none; color: lightgray; margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;">
                           –°–∏–±–∏—Ä—Å–∫–∏–π –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç
                        </a>
                    </td>
                    <td style="text-align:right;">
                        <p class="nav-group-right" style="margin-bottom: auto; margin-top: 5px; font-size: 1.25rem;">@skill_issue 2025</p>
                    </td>
                </tr>
                <tr>
                    <td><p style="text-align:left">@bukohm</p></td>
                    <td><p style="text-align:center">@hoolkayyy</p></td>
                    <td><p style="text-align:right">@K1rkaSs</p></td>
                </tr>
            </table>
        </div>
    </footer>

<script src="{% static 'js/auth.js' %}"></script>
<script src="{% static 'js/toggle_chat.js' %}"></script>
<script src="{% static 'js/filter.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const menuContainer = document.querySelector(".menu-container");

    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º authManager –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º
        const response = await authManager.apiRequest("/api/me/");

        if (response.ok) {
            const user = await response.json();
            menuContainer.innerHTML = `
                <a class="nav-links" href="/users/${user.username}/" style="margin-right: 20px;">–ø—Ä–æ—Ñ–∏–ª—å</a>
                <a class="nav-links" href="#" id="logout-btn">–≤—ã–π—Ç–∏</a>
            `;

            const logoutBtn = document.getElementById("logout-btn");
            if (logoutBtn) {
                logoutBtn.addEventListener("click", async (e) => {
                    e.preventDefault();
                    authManager.logout();
                });
            }
        } else {
            // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ–Ω—é
            menuContainer.innerHTML = `
                <a class="nav-links" href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
                <div class="context-menu">
                    <a href="{% url 'register_page' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                    <a href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
                </div>
            `;
        }
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏", err);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ–Ω—é
        menuContainer.innerHTML = `
            <a class="nav-links" href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
            <div class="context-menu">
                <a href="{% url 'register_page' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                <a href="{% url 'login_page' %}">–≤–æ–π—Ç–∏</a>
            </div>
        `;
    }
});
</script>
</body>
</html>
