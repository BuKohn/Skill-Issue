{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактировать профиль — Skill Issue</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
<header class="header" id="header">
    <nav class="header-container">
        <a class="logo" href="{% url 'main_page' %}">Skill Issue</a>
        <div class="nav-group nav-group-left">
            <a class="nav-links" href="{% url 'guides_list' %}" data-lang-ru="руководства" data-lang-en="guides">руководства</a>
            <a class="nav-links" href="#" data-lang-ru="объявления" data-lang-en="announcements">объявления</a>
        </div>
        <div class="nav-group nav-group-right">
            <div class="search-container">
                    <input class="search" placeholder="поиск руководств, анкет и профилей" id="searchInput"
                           data-placeholder-ru="поиск руководств, анкет и профилей"
                           data-placeholder-en="search guides, profiles and announcements">
                    <div class="search-dropdown" id="searchDropdown">
                    </div>
            </div>
            <a class="nav-links" href="#" data-lang-ru="избранное" data-lang-en="favorites">избранное</a>
            <a class="nav-links" id="language-toggle" href="#" onclick="toggleLanguage(event)" title="Сменить язык">RU</a>
            <div class="menu-container">
                {% if user.is_authenticated %}
                    <a class="nav-links" href="{% url 'logout_page' %}" data-lang-ru="выйти" data-lang-en="log out">выйти</a>
                {% else %}
                    <a class="nav-links" href="{% url 'login_page' %}" data-lang-ru="войти" data-lang-en="log in">войти</a>
                    <div class="context-menu">
                        <a href="{% url 'register_page' %}" data-lang-ru="зарегистрироваться" data-lang-en="register">зарегистрироваться</a>
                        <a href="{% url 'login_page' %}" data-lang-ru="войти" data-lang-en="log in">войти</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>
</header>

<div class="body-background">
    <form id="profile-form" method="POST" enctype="multipart/form-data" style="text-align:center;">
        {% csrf_token %}
        <div class="profile-row-container">
            <div class="image-container" style="position:relative; display:inline-block;">
                {% if profile.avatar %}
                    <img id="profile-image" src="{{ profile.avatar.url }}" alt="avatar" style="padding:20px; width:250px; height:250px; border-radius:50%;">
                {% else %}
                    <img id="profile-image" src="{% static 'images/default-avatar.jpg' %}" alt="avatar" style="padding:20px; width:250px; height:250px; border-radius:50%;">
                {% endif %}
                <div class="hover-text" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); opacity:0; transition:opacity 0.3s;">
                    <label for="file-input" class="simple-text" style="color:white; background:rgba(0,0,0,0.7); padding:5px 10px; border-radius:5px; cursor:pointer;"
                           data-lang-ru="выбрать"
                           data-lang-en="choose">выбрать</label>
                    <input id="file-input" name="avatar" type="file" accept="image/*" style="display:none;">
                </div>
            </div>

            <div class="profile-column-container" style="min-width:67%;">
                <input id="username-input" name="username" class="profile-input" value="{{ user.username }}"
                       style="font-size:1.5rem; padding:20px 20px 0 0;"
                       placeholder="Введите никнейм"
                       data-placeholder-ru="Введите никнейм"
                       data-placeholder-en="Enter nickname">
                <hr style="color:black; width:100%;">
                <input id="description-input" name="description" class="profile-input"
                   value="{{ profile.bio|default:'' }}"
                   style="font-size:1.3rem; padding:0 20px 20px 0; width:100%;"
                   placeholder="Введите описание"
                   data-placeholder-ru="Введите описание"
                   data-placeholder-en="Enter description">
                <a class="simple-text" style="font-size:1rem; padding:20px 20px 5px 0;"
                   data-lang-ru="Рейтинг: {{ profile.rating|default:"0" }}/5"
                   data-lang-en="Rating: {{ profile.rating|default:"0" }}/5">Рейтинг: {{ profile.rating|default:"0" }}/5</a>
            </div>
        </div>
        <button id="save-button" type="submit" class="profile-button" style="margin:20px 0; width:200px; height:35px;"
                data-lang-ru="Сохранить"
                data-lang-en="Save">Сохранить</button>
    </form>
</div>

<footer class="footer">
    <div class="footer-container">
        <table class="simple-text" style="width:100%; height:100%; color:lightgray; font-size:1rem;">
            <tr>
                <td colspan="3" style="width:33%;">
                    <a href="https://www.sfu.ru/ru" class="nav-group-left" style="text-decoration:none; color:lightgray; margin-top:5px; font-size:1.25rem;"
                       data-lang-ru="Сибирский Федеральный Университет"
                       data-lang-en="Siberian Federal University">Сибирский Федеральный Университет</a>
                </td>
                <td style="text-align:right;">
                    <p class="nav-group-right" style="margin-top:5px; font-size:1.25rem;">@skill_issue 2025</p>
                </td>
            </tr>
            <tr>
                <td><p style="text-align:left;">@bukohm</p></td>
                <td><p style="text-align:center;">@hoolkayyy</p></td>
                <td><p style="text-align:right;">@K1rkaSs</p></td>
            </tr>
        </table>
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const imgContainer = document.querySelector('.image-container');
    const hoverText = imgContainer.querySelector('.hover-text');
    const fileInput = document.getElementById('file-input');
    const img = document.getElementById('profile-image');
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("updated") === "1") {
        const lang = localStorage.getItem('lang') || 'RU';
        const msg = lang === 'RU' ? "✅ Профиль успешно обновлён!" : "✅ Profile updated successfully!";
        alert(msg);
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }

    imgContainer.addEventListener('mouseenter', () => hoverText.style.opacity = '1');
    imgContainer.addEventListener('mouseleave', () => hoverText.style.opacity = '0');

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
<script src="{% static 'js/search.js' %}"></script>
<script src="{% static 'js/toggle_language.js' %}"></script>
</body>
</html>